{% extends "base.html" %}
{% block title %}Global Stats{% endblock %}

{% block content %}
<style>
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .fade-in {
    animation: fadeInUp 0.5s ease-out both;
  }
</style>

<div class="fade-in space-y-12 max-w-5xl mx-auto mt-8">

  <h1 class="text-4xl font-bold text-center text-white">üåç Global Stats</h1>

  <!-- Summary Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg text-center">
      <h3 class="text-sm text-gray-400">Total Games Played</h3>
      <p class="text-3xl font-bold text-white mt-1">{{ total_games }}</p>
    </div>
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg text-center">
      <h3 class="text-sm text-gray-400">Total Money Circulated</h3>
      <p class="text-3xl font-bold text-white mt-1">{{ total_money }} NOK</p>
    </div>
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg text-center">
      <h3 class="text-sm text-gray-400">Unique Winners</h3>
      <p class="text-3xl font-bold text-green-400 mt-1">{{ unique_winners }}</p>
    </div>
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg text-center">
      <h3 class="text-sm text-gray-400">Top Player</h3>
      <p class="text-xl font-semibold text-yellow-400 mt-1">{{ top_player }}</p>
    </div>
  </div>

  <!-- Top 5 Players Table -->
  <section class="bg-gray-800 p-8 rounded-lg shadow-lg">
    <h2 class="text-xl font-semibold mb-4 text-white">Top 5 Players</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-left table-auto text-sm">
        <thead>
          <tr class="text-gray-400 border-b border-gray-600 uppercase text-xs tracking-wide">
            <th class="px-4 py-3">Player</th>
            <th class="px-4 py-3 text-right">Total Won</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-700">
          {% for p in top_players %}
          <tr class="{{ loop.index is even and 'bg-gray-900' or '' }}">
            <td class="px-4 py-3 font-medium">{{ p['winner'] }}</td>
            <td class="px-4 py-3 text-right text-green-400 font-semibold">{{ p['total_won'] }} NOK</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="2" class="px-4 py-4 text-center text-gray-400">No data available.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Line Chart -->
  <section class="bg-gray-800 p-8 rounded-lg shadow-lg">
    <h2 class="text-xl font-semibold mb-4 text-white">Cumulative Player Progress</h2>
    <canvas id="progressChart" class="w-full h-64"></canvas>
  </section>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
fetch('/global-stats-data')
  .then(res => res.json())
  .then(({ labels, datasets }) => {
    const ctx = document.getElementById('progressChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: { labels, datasets },
      options: {
        responsive: true,
        scales: {
          x: { display: true, title: { display: true, text: 'Game Date' } },
          y: { display: true, title: { display: true, text: 'Balance (NOK)' } }
        },
        interaction: { mode: 'index', intersect: false },
        plugins: {
          legend: {
            position: 'bottom',
            labels: { color: '#ccc' }
          }
        }
      }
    });
  });
</script>
{% endblock %}
