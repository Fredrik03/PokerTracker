{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="space-y-8">

  <h1 class="text-3xl font-bold text-center mb-4">Dashboard</h1>

  <div class="bg-gray-800 text-white p-6 rounded-lg shadow-lg text-center text-xl font-bold">
    Welcome, {{ username }}
  </div>

  <!-- Summary cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- First row -->
    <div class="bg-gray-800 p-8 rounded-lg shadow-lg flex flex-col items-center justify-center">
      <h3 class="text-base font-medium text-gray-400">Total Sessions</h3>
      <p class="text-3xl font-extrabold text-white mt-2">{{ total_games }}</p>
    </div>

    <div class="bg-gray-800 p-8 rounded-lg shadow-lg flex flex-col items-center justify-center">
      <h3 class="text-base font-medium text-gray-400">Net Profit / Loss</h3>
      <p class="text-3xl font-extrabold mt-2 {{ 'text-green-400' if net_sum >= 0 else 'text-red-400' }}">
        {{ net_sum }} NOK
      </p>
    </div>

    <!-- Second row -->
    <div class="bg-gray-800 p-8 rounded-lg shadow-lg flex flex-col items-center justify-center">
      <h3 class="text-base font-medium text-gray-400">Avg Profit</h3>
      <p class="text-3xl font-extrabold mt-2 {{ 'text-green-400' if avg_profit >= 0 else 'text-red-400' }}">
        {{ avg_profit }} NOK
      </p>
    </div>

    <div class="bg-gray-800 p-8 rounded-lg shadow-lg flex flex-col items-center justify-center">
      <h3 class="text-base font-medium text-gray-400">Win Rate</h3>
      <p class="text-3xl font-extrabold mt-2 {{ 'text-green-400' if avg_profit >= 0 else 'text-red-400' }}">
        {{ win_rate }}â€‰%
      </p>
    </div>
  </div>

  <!-- Progress chart -->
  <section class="bg-gray-800 p-8 rounded-lg shadow-lg">
    <h2 class="text-xl font-semibold mb-4">Cumulative Progress</h2>
    <canvas id="progressChart" class="w-full h-64"></canvas>
  </section>

  <!-- Recent games table -->
  <section class="bg-gray-800 p-8 rounded-lg shadow-lg">
    <h2 class="text-xl font-semibold mb-4">Recent Sessions</h2>
    <div class="overflow-x-auto">
      <table class="w-full table-auto text-left text-sm">
        <thead>
          <tr class="border-b border-gray-600 text-gray-400 uppercase text-xs tracking-wider">
            <th class="px-4 py-2">Date</th>
            <th class="px-4 py-2">Net</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-700">
          {% for r in recent %}
          <tr>
            <td class="px-4 py-2">{{ r.date }}</td>
            <td class="px-4 py-2 {{ 'text-green-400' if r.net >= 0 else 'text-red-400' }}">
              {{ r.net }} NOK
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="2" class="px-4 py-2 text-center text-gray-400">No sessions yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('progressChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ dates | tojson }},
      datasets: [{
        label: 'Cumulative Net',
        data: {{ cumulative | tojson }},
        fill: false,
        borderWidth: 2,
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: { display: true, title: { display: true, text: 'Date' } },
        y: { display: true, title: { display: true, text: 'Net NOK' } }
      },
      plugins: { legend: { display: false } }
    }
  });
</script>
{% endblock %}
